<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generate data samples &mdash; pycompwa  documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Particle database" href="particles.html" />
    <link rel="prev" title="Data module" href="data_module.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html"><img src="../../_static/logo-small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../usage.html">Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../workflow.html">ComPWA Workflow</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tools.html">Additional Tools</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="data_module.html">Data module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Generate data samples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Phase-space-samples">Phase space samples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Intensity-based-samples">Intensity-based samples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Importance-sampling">Importance sampling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="particles.html">Particle database</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documents.html">Talks and Documents</a></li>
</ul>

    <a href= "../../py-modindex.html">Module Index (API)</a>
    <a href= "../../genindex.html">General Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pycompwa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../usage.html">Usage</a> &raquo;</li>
          <li><a href="../tools.html">Additional Tools</a> &raquo;</li>
      <li>Generate data samples</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ComPWA/pycompwa/blob/main/docsusage/tools/generate.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="data_module.html" class="btn btn-neutral float-left" title="Data module" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="particles.html" class="btn btn-neutral float-right" title="Particle database" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p>Download this notebook <a class="reference download internal" download="" href="../../_downloads/248a28b1004a39ad0667560f7ab0642f/generate.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<section id="Generate-data-samples">
<h1>Generate data samples<a class="headerlink" href="#Generate-data-samples" title="Permalink to this headline">¶</a></h1>
<p>There are two different types of data samples: (1) <a class="reference internal" href="#Phase-space-samples"><span class="std std-ref">phase space samples</span></a> and (2) <a class="reference internal" href="#Intensity-based-samples"><span class="std std-ref">intensity-based
samples</span></a> (which mimick the
intensity distributions of the reaction). In addition, you may want to
generate more data points in specific regions of phase space (e.g. in the
case of a sharp resonance). This is called <a class="reference internal" href="#Importance-sampling"><span class="std std-ref">importance sampling</span></a>.</p>
<p>Usually, you need a phase space sample to generate an intensity-based sample,
so we start with that.</p>
<section id="Phase-space-samples">
<h2>Phase space samples<a class="headerlink" href="#Phase-space-samples" title="Permalink to this headline">¶</a></h2>
<p>With the <a class="reference internal" href="../../api/pycompwa.ui.html#module-pycompwa.ui" title="pycompwa.ui"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pycompwa.ui</span></code></a> module you can easily create various types of
Monte Carlo phase space samples. You do this with the function
<a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.generate_phsp" title="pycompwa.ui.generate_phsp"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate_phsp()</span></code></a>.</p>
<p>One of the required arguments is a <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.PhaseSpaceEventGenerator" title="pycompwa.ui.PhaseSpaceEventGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">PhaseSpaceEventGenerator</span></code></a>
instance. There are currently two options: <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.EvtGenGenerator" title="pycompwa.ui.EvtGenGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">EvtGenGenerator</span></code></a> and
<a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.RootGenerator" title="pycompwa.ui.RootGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootGenerator</span></code></a>. Using the <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.EvtGenGenerator" title="pycompwa.ui.EvtGenGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">EvtGenGenerator</span></code></a> is recommended
for numerical precision:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="sig-name descname">EvtGenGenerator</code></dt>
<dd><p>Bases: <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.PhaseSpaceEventGenerator" title="pycompwa.ui.PhaseSpaceEventGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">pycompwa.ui.PhaseSpaceEventGenerator</span></code></a></p>
</dd></dl>

<p>As you can see, such a <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.PhaseSpaceEventGenerator" title="pycompwa.ui.PhaseSpaceEventGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">PhaseSpaceEventGenerator</span></code></a> requires state
transition info from a <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.Kinematics" title="pycompwa.ui.Kinematics"><code class="xref py py-class docutils literal notranslate"><span class="pre">Kinematics</span></code></a> instance, such as the
<a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.HelicityKinematics" title="pycompwa.ui.HelicityKinematics"><code class="xref py py-class docutils literal notranslate"><span class="pre">HelicityKinematics</span></code></a> class.</p>
<p>The second argument for the <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.generate_phsp" title="pycompwa.ui.generate_phsp"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate_phsp()</span></code></a> function is a random
number generator. Here, there are again two options:
<a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.StdUniformRealGenerator" title="pycompwa.ui.StdUniformRealGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">StdUniformRealGenerator</span></code></a> and <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.RootUniformRealGenerator" title="pycompwa.ui.RootUniformRealGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootUniformRealGenerator</span></code></a>.</p>
<p>To illustrate this procedure, we first need to <a class="reference internal" href="../workflow/1_create_model.html"><span class="doc">create some kinematics
model</span></a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>  <span class="c1"># not interested in warnings now</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pycompwa.expertsystem.amplitude.helicitydecay</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">HelicityAmplitudeGeneratorXML</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pycompwa.expertsystem.ui.system_control</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">InteractionTypes</span><span class="p">,</span>
    <span class="n">StateTransitionManager</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">initial_state</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;J/psi&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span>
<span class="n">final_state</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;gamma&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;pi0&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;pi0&quot;</span><span class="p">)]</span>
<span class="n">tbd_manager</span> <span class="o">=</span> <span class="n">StateTransitionManager</span><span class="p">(</span>
    <span class="n">initial_state</span><span class="p">,</span>
    <span class="n">final_state</span><span class="p">,</span>
    <span class="n">formalism_type</span><span class="o">=</span><span class="s2">&quot;helicity&quot;</span><span class="p">,</span>
    <span class="n">topology_building</span><span class="o">=</span><span class="s2">&quot;isobar&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">tbd_manager</span><span class="o">.</span><span class="n">set_allowed_interaction_types</span><span class="p">(</span>
    <span class="p">[</span><span class="n">InteractionTypes</span><span class="o">.</span><span class="n">Strong</span><span class="p">,</span> <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">EM</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">tbd_manager</span><span class="o">.</span><span class="n">allowed_intermediate_particles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>

<span class="n">graph_interaction_settings_groups</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">prepare_graphs</span><span class="p">()</span>
<span class="n">solutions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span><span class="n">graph_interaction_settings_groups</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; solutions!&quot;</span><span class="p">)</span>

<span class="n">xml_generator</span> <span class="o">=</span> <span class="n">HelicityAmplitudeGeneratorXML</span><span class="p">()</span>
<span class="n">xml_generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
<span class="n">xml_generator</span><span class="o">.</span><span class="n">write_to_file</span><span class="p">(</span><span class="s2">&quot;model.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2021-10-23 15:18:50,391 INFO [default] Logging to file disabled!
2021-10-23 15:18:50,391 [INFO] Log level: INFO
2021-10-23 15:18:50,391 [INFO] Current date and time: Sat Oct 23 15:18:50 2021

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/hostedtoolcache/Python/3.7.12/x64/lib/python3.7/site-packages/traitlets/traitlets.py:3050: FutureWarning: --rc={&#39;figure.dpi&#39;: 96} for dict-traits is deprecated in traitlets 5.0. You can pass --rc &lt;key=value&gt; ... multiple times to add items to a dict.
  FutureWarning,
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
found 32 solutions!
</pre></div></div>
</div>
<p>Now we can go through the procedure explained above:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pycompwa.ui</span> <span class="k">as</span> <span class="nn">pwa</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># specify kinematics</span>
<span class="n">kinematics</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">create_helicity_kinematics</span><span class="p">(</span><span class="s2">&quot;model.xml&quot;</span><span class="p">)</span>

<span class="c1"># specify generators</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">EvtGenGenerator</span><span class="p">(</span>
    <span class="n">kinematics</span><span class="o">.</span><span class="n">get_particle_state_transition_kinematics_info</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">random_generator</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">StdUniformRealGenerator</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="c1"># generate phase space sample</span>
<span class="n">phsp_sample</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">generate_phsp</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">random_generator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2021-10-23 15:18:56,868 [INFO] HelicityKinematics::HelicityKinematics() | Initialized kinematics for reaction ( J/psi )-&gt;( gamma[ID=2] pi0[ID=3] pi0[ID=4] )
Event position to final state ID mapping:
0: 2
1: 3
2: 4

2021-10-23 15:18:56,870 [INFO] Generating phase-space MC: [1000 events]

 0.00min [ ********** 100.00% ] 0.00min , end time: 03:18PM
</pre></div></div>
</div>
</section>
<section id="Intensity-based-samples">
<h2>Intensity-based samples<a class="headerlink" href="#Intensity-based-samples" title="Permalink to this headline">¶</a></h2>
<p>Data samples are more complicated than phase space samples in that they
represent the intensity profile resulting from a reaction. You therefore need
an <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.Intensity" title="pycompwa.ui.Intensity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Intensity</span></code></a> object and a phase space over which to generate that
intensity distribution. We therefore call such a data sample an
<strong>intensity-based sample</strong>.</p>
<p>An intensity-based sample is generated with the function
<a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.generate" title="pycompwa.ui.generate"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate()</span></code></a>. Its usage is similar to <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.generate_phsp" title="pycompwa.ui.generate_phsp"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate_phsp()</span></code></a>, but
now you have to give an <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.Intensity" title="pycompwa.ui.Intensity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Intensity</span></code></a> and a <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.Kinematics" title="pycompwa.ui.Kinematics"><code class="xref py py-class docutils literal notranslate"><span class="pre">Kinematics</span></code></a>
instance as additional arguments. Sampling is performed through hit &amp; miss,
which is reflected by the efficiency printed at the end.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create intensity profile</span>
<span class="n">particle_list</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">read_particles</span><span class="p">(</span><span class="s2">&quot;model.xml&quot;</span><span class="p">)</span>
<span class="n">intensity_builder</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">IntensityBuilderXML</span><span class="p">(</span>
    <span class="s2">&quot;model.xml&quot;</span><span class="p">,</span> <span class="n">particle_list</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">,</span> <span class="n">phsp_sample</span>
<span class="p">)</span>
<span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity_builder</span><span class="o">.</span><span class="n">create_intensity</span><span class="p">()</span>

<span class="c1"># generate data</span>
<span class="n">data_sample</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
    <span class="mi">100</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">random_generator</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2021-10-23 15:18:56,893 [INFO] Setting phase space sample weights...
2021-10-23 15:18:56,902 [INFO] Updating data container content...
2021-10-23 15:18:56,927 [INFO] Generating hit-and-miss sample: [100 events]
 0.00min [ ---------- 0.00% ] 0.00min , end time: 03:18PM
 0.00min [ ********** 100.00% ] 0.00min , end time: 03:18PM               2021-10-23 15:18:57,223 [INFO] Successfully generated 100 with an efficiency of 0.00666667

</pre></div></div>
</div>
</section>
<section id="Importance-sampling">
<h2>Importance sampling<a class="headerlink" href="#Importance-sampling" title="Permalink to this headline">¶</a></h2>
<p>In the example above, we used the decay <span class="math notranslate nohighlight">\(J/\psi \to \gamma \pi^0 \pi^0\)</span> with f resonances only. Imagine, however, that we want to investigate the resonance <span class="math notranslate nohighlight">\(\omega \to \gamma\pi^0\)</span>. This resonance has such a narrow peak that you will run into problems when normalizing the intensity model.</p>
<p>To normalize a distribution, you need know the integral over that distribution. The integral over an intensity distribution distribution can only be computed numerically. We simply do this by computing the sum of the intensities evaluated for each point in a phase space (Monte Carlo integration), and averaging over the number of phase space points. This means that the higher the number of phase space points, the more accurate your integral.</p>
<p>With a narrow peak, however, many of the points in an evenly distributed phase space sample will lie outside the peak region, where the intensity (and therefore their contribution to the integral) is highest. So in order to have a good estimate for the integral over this narrow peak structure, you want to have a larger number of phase space points under that peak. Now, you could just use a bigger phase space sample (increasing number of points within the peak region), but this will be resource
intensive as it will result in many hits in regions that hardly contributes to the integral.</p>
<p>A smarter strategy is generate a sample that has a higher density of phase space points within the peak region. This strategy is called <strong>importance sampling</strong>.</p>
<p>We first again create an amplitude model, this time including a ‘widened’
<span class="math notranslate nohighlight">\(\omega\)</span> resonance (see also <a class="reference internal" href="particles.html"><span class="doc">Particle database</span></a>). Widening <span class="math notranslate nohighlight">\(\omega\)</span>
is only done so that the resonance is still visible―the peak is still
extremely narrow.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pycompwa.expertsystem.amplitude.helicitydecay</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">HelicityAmplitudeGeneratorXML</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pycompwa.expertsystem.state.particle</span> <span class="kn">import</span> <span class="n">particle_list</span>
<span class="kn">from</span> <span class="nn">pycompwa.expertsystem.ui.system_control</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">InteractionTypes</span><span class="p">,</span>
    <span class="n">StateTransitionManager</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">initial_state</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;J/psi&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span>
<span class="n">final_state</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;gamma&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;pi0&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;pi0&quot;</span><span class="p">)]</span>
<span class="n">tbd_manager</span> <span class="o">=</span> <span class="n">StateTransitionManager</span><span class="p">(</span>
    <span class="n">initial_state</span><span class="p">,</span>
    <span class="n">final_state</span><span class="p">,</span>
    <span class="n">formalism_type</span><span class="o">=</span><span class="s2">&quot;helicity&quot;</span><span class="p">,</span>
    <span class="n">topology_building</span><span class="o">=</span><span class="s2">&quot;isobar&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Widen omega resonance</span>
<span class="n">omega</span> <span class="o">=</span> <span class="n">particle_list</span><span class="p">[</span><span class="s2">&quot;omega(782)&quot;</span><span class="p">]</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="s2">&quot;DecayInfo&quot;</span><span class="p">][</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">par</span><span class="p">[</span><span class="s2">&quot;@Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Width&quot;</span><span class="p">:</span>
        <span class="n">par</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="n">tbd_manager</span><span class="o">.</span><span class="n">set_allowed_interaction_types</span><span class="p">(</span>
    <span class="p">[</span><span class="n">InteractionTypes</span><span class="o">.</span><span class="n">Strong</span><span class="p">,</span> <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">EM</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">tbd_manager</span><span class="o">.</span><span class="n">allowed_intermediate_particles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;f2(1270)&quot;</span><span class="p">,</span> <span class="s2">&quot;omega&quot;</span><span class="p">]</span>
<span class="n">graph_interaction_settings_groups</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">prepare_graphs</span><span class="p">()</span>
<span class="n">solutions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span><span class="n">graph_interaction_settings_groups</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; solutions!&quot;</span><span class="p">)</span>

<span class="n">xml_generator</span> <span class="o">=</span> <span class="n">HelicityAmplitudeGeneratorXML</span><span class="p">()</span>
<span class="n">xml_generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
<span class="n">xml_generator</span><span class="o">.</span><span class="n">write_to_file</span><span class="p">(</span><span class="s2">&quot;model.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
found 28 solutions!
</pre></div></div>
</div>
<p>Now we generate a phase space sample that is importance sampled by the
intensity. This can be done with the
<a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.generate_importance_sampled_phsp" title="pycompwa.ui.generate_importance_sampled_phsp"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate_importance_sampled_phsp()</span></code></a> function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that you still need a ‘normal’ phase space sample for the
<a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.IntensityBuilderXML" title="pycompwa.ui.IntensityBuilderXML"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntensityBuilderXML</span></code></a>. In theory, however, this shouldn’t be
necessary at this stage, but in the current implementation, this sample
is required for computing the outermost intensity. Luckily, during data
generation the parameters of the model stay fixed, so this normalization
is irrelevant and just causes a constant scaling factor.</p>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pycompwa.ui</span> <span class="k">as</span> <span class="nn">pwa</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># specify kinematics</span>
<span class="n">particle_list</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">read_particles</span><span class="p">(</span><span class="s2">&quot;model.xml&quot;</span><span class="p">)</span>
<span class="n">kinematics</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">create_helicity_kinematics</span><span class="p">(</span><span class="s2">&quot;model.xml&quot;</span><span class="p">,</span> <span class="n">particle_list</span><span class="p">)</span>

<span class="c1"># specify generators</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">EvtGenGenerator</span><span class="p">(</span>
    <span class="n">kinematics</span><span class="o">.</span><span class="n">get_particle_state_transition_kinematics_info</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">random_generator</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">StdUniformRealGenerator</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="c1"># generate evenly distributed phase space sample</span>
<span class="n">phsp_sample</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">generate_phsp</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">random_generator</span><span class="p">)</span>

<span class="c1"># create intensity</span>
<span class="n">intensity_builder</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">IntensityBuilderXML</span><span class="p">(</span>
    <span class="s2">&quot;model.xml&quot;</span><span class="p">,</span> <span class="n">particle_list</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">,</span> <span class="n">phsp_sample</span>
<span class="p">)</span>
<span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity_builder</span><span class="o">.</span><span class="n">create_intensity</span><span class="p">()</span>

<span class="c1"># generate importance-sampled phase space sample</span>
<span class="n">phsp_sample_importance</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">generate_importance_sampled_phsp</span><span class="p">(</span>
    <span class="mi">2000</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">random_generator</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2021-10-23 15:19:00,548 [INFO] HelicityKinematics::HelicityKinematics() | Initialized kinematics for reaction ( J/psi )-&gt;( gamma[ID=2] pi0[ID=3] pi0[ID=4] )
Event position to final state ID mapping:
0: 2
1: 3
2: 4

2021-10-23 15:19:00,549 [INFO] Generating phase-space MC: [100000 events]
 0.00min [ ---------- 0.00% ] 0.00min , end time: 03:19PM
 0.00min [ ********** 100.00% ] 0.00min , end time: 03:19PM
2021-10-23 15:19:00,643 [INFO] Setting phase space sample weights...
2021-10-23 15:19:00,646 [ERROR] IntensityBuilderXML::addFunctionTreeComponent(): FunctionTree with name J/psi_-1_to_omega(782)_1+pi0_0;omega(782)_1_to_gamma_1+pi0_0; already exists!
2021-10-23 15:19:00,647 [ERROR] IntensityBuilderXML::addFunctionTreeComponent(): FunctionTree with name J/psi_-1_to_omega(782)_-1+pi0_0;omega(782)_-1_to_gamma_1+pi0_0; already exists!
2021-10-23 15:19:00,649 [ERROR] IntensityBuilderXML::addFunctionTreeComponent(): FunctionTree with name J/psi_1_to_omega(782)_1+pi0_0;omega(782)_1_to_gamma_-1+pi0_0; already exists!
2021-10-23 15:19:00,649 [ERROR] IntensityBuilderXML::addFunctionTreeComponent(): FunctionTree with name J/psi_1_to_omega(782)_-1+pi0_0;omega(782)_-1_to_gamma_-1+pi0_0; already exists!
2021-10-23 15:19:00,651 [ERROR] IntensityBuilderXML::addFunctionTreeComponent(): FunctionTree with name J/psi_1_to_omega(782)_1+pi0_0;omega(782)_1_to_gamma_1+pi0_0; already exists!
2021-10-23 15:19:00,652 [ERROR] IntensityBuilderXML::addFunctionTreeComponent(): FunctionTree with name J/psi_1_to_omega(782)_-1+pi0_0;omega(782)_-1_to_gamma_1+pi0_0; already exists!
2021-10-23 15:19:00,654 [ERROR] IntensityBuilderXML::addFunctionTreeComponent(): FunctionTree with name J/psi_-1_to_omega(782)_1+pi0_0;omega(782)_1_to_gamma_-1+pi0_0; already exists!
2021-10-23 15:19:00,655 [ERROR] IntensityBuilderXML::addFunctionTreeComponent(): FunctionTree with name J/psi_-1_to_omega(782)_-1+pi0_0;omega(782)_-1_to_gamma_-1+pi0_0; already exists!
2021-10-23 15:19:00,660 [INFO] Updating data container content...
2021-10-23 15:19:02,800 [INFO] Generating phase space sample (hit-and-miss importance sampled): [2000 events]
 0.00min [ ---------- 0.00% ] 0.00min , end time: 03:19PM
2021-10-23 15:19:03,274 [INFO] Tools::generateImportanceSampledPhsp() | Error in HitMiss procedure: Maximum value of random number generation smaller then amplitude maximum! We raise the maximum to 46.4232 value and restart generation!
 0.00min [ ---------- 0.00% ] 0.00min , end time: 03:19PM
2021-10-23 15:19:03,497 [INFO] Tools::generateImportanceSampledPhsp() | Error in HitMiss procedure: Maximum value of random number generation smaller then amplitude maximum! We raise the maximum to 51.6626 value and restart generation!

 0.00min [ ---------- 0.00% ] 0.00min , end time: 03:19PM               2021-10-23 15:19:03,959 [INFO] Tools::generateImportanceSampledPhsp() | Error in HitMiss procedure: Maximum value of random number generation smaller then amplitude maximum! We raise the maximum to 69.7599 value and restart generation!
 0.00min [ ---------- 0.00% ] 0.00min , end time: 03:19PM
 0.05min [ ********** 100.00% ] 0.00min , end time: 03:19PM
</pre></div></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The current implementation is simple and uniformly generates events in
the phase space domain. Depending on the shape of your Intensity, this
can be quite computation intensive. However, ideally you would only run
this once for a specific reaction.</p>
</div>
<p>The effect of this importance sampling can be best seen in a Dalitz plot. There, one can see that there are more events in the regions where the intensity is large (the resonances), but one still sees a uniform distribution overall.</p>
<p>To create a Dalitz plot, we first have to create a <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.DataSet" title="pycompwa.ui.DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataSet</span></code></a>, as we
saw in <a class="reference internal" href="../workflow/4_analyze_results.html#4.2-Visualize"><span class="std std-ref">this section</span></a>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">kinematics</span><span class="o">.</span><span class="n">create_all_subsystems</span><span class="p">()</span>
<span class="n">phsp_set</span> <span class="o">=</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">phsp_sample</span><span class="p">)</span>
<span class="n">phsp_set_importance</span> <span class="o">=</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">phsp_sample_importance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2021-10-23 15:19:07,278 [INFO] creating all Subsystems!
</pre></div></div>
</div>
<p>We can then use <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.html#module-matplotlib.pyplot" title="(in Matplotlib v3.4.3)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code></a> to create the Dalitz plot. Note that
we use <a class="reference internal" href="../../api/pycompwa.data.naming.html#pycompwa.data.naming.replace_ids" title="pycompwa.data.naming.replace_ids"><code class="xref py py-obj docutils literal notranslate"><span class="pre">replace_ids</span></code></a> to transform the final state IDs into readable
particles names.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>

<span class="kn">from</span> <span class="nn">pycompwa.data</span> <span class="kn">import</span> <span class="n">naming</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">dalitz_plot</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">mass_x</span><span class="p">,</span> <span class="n">mass_y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function to create a Dalitz plot with useful axis titles.&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span>
        <span class="n">data_set</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mass_x</span><span class="p">],</span>
        <span class="n">data_set</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mass_y</span><span class="p">],</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">data_set</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">naming</span><span class="o">.</span><span class="n">replace_ids</span><span class="p">(</span><span class="n">mass_x</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">naming</span><span class="o">.</span><span class="n">replace_ids</span><span class="p">(</span><span class="n">mass_y</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dalitz_plot</span><span class="p">(</span>
    <span class="n">phsp_set_importance</span><span class="p">,</span> <span class="s2">&quot;mSq_(3,4)&quot;</span><span class="p">,</span> <span class="s2">&quot;mSq_(2,4)&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;importance-sampled phase space&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tools_generate_29_0.svg" src="../../_images/usage_tools_generate_29_0.svg" /></div>
</div>
<p>Note how this compares to the evenly distributed phase space sample and the intensity-based sample:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dalitz_plot</span><span class="p">(</span><span class="n">phsp_set</span><span class="p">,</span> <span class="s2">&quot;mSq_(3,4)&quot;</span><span class="p">,</span> <span class="s2">&quot;mSq_(2,4)&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;evenly distributed phase space&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tools_generate_31_0.svg" src="../../_images/usage_tools_generate_31_0.svg" /></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pwa</span><span class="o">.</span><span class="n">Logging</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
<span class="n">data_sample</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
    <span class="mi">2000</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">random_generator</span>
<span class="p">)</span>
<span class="n">data_set</span> <span class="o">=</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">data_sample</span><span class="p">)</span>
<span class="n">dalitz_plot</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="s2">&quot;mSq_(3,4)&quot;</span><span class="p">,</span> <span class="s2">&quot;mSq_(2,4)&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;intensity-based sample&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2021-10-23 15:19:12,215 [INFO] Logging to file disabled!
 0.00min [ ---------- 0.00% ] 0.00min , end time: 03:19PM
 0.00min [ ---------- 0.00% ] 0.00min , end time: 03:19PM
 0.00min [ ---------- 0.00% ] 0.00min , end time: 03:19PM
 0.05min [ ********** 100.00% ] 0.00min , end time: 03:19PM
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tools_generate_32_1.svg" src="../../_images/usage_tools_generate_32_1.svg" /></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data_module.html" class="btn btn-neutral float-left" title="Data module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="particles.html" class="btn btn-neutral float-right" title="Particle database" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>