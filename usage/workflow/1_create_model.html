

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Step 1: Create an amplitude model &mdash; pycompwa  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Step 2: Generate data samples" href="2_generate_data.html" />
    <link rel="prev" title="ComPWA Workflow" href="../workflow.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../usage.html">Usage</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../workflow.html">ComPWA Workflow</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Step 1: Create an amplitude model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#1.1.-Define-the-problem-set">1.1. Define the problem set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1.2.-Prepare-topologies">1.2. Prepare topologies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1.3.-Find-solutions">1.3. Find solutions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="2_generate_data.html">Step 2: Generate data samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="3_perform_fit.html">Step 3: Perform fit</a></li>
<li class="toctree-l3"><a class="reference internal" href="4_analyze_results.html">Step 4: Analyze results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tools.html">Additional Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documents.html">Talks and Documents</a></li>
</ul>

            
          
    <a href= "../../py-modindex.html">Module Index (API)</a>
    <a href= "../../genindex.html">General Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pycompwa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../usage.html">Usage</a> &raquo;</li>
        
          <li><a href="../workflow.html">ComPWA Workflow</a> &raquo;</li>
        
      <li>Step 1: Create an amplitude model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/ComPWA/pycompwa/blob/master/doc/source/usage/workflow/1_create_model.ipynb" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="2_generate_data.html" class="btn btn-neutral float-right" title="Step 2: Generate data samples" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../workflow.html" class="btn btn-neutral float-left" title="ComPWA Workflow" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p>Download this notebook <a class="reference download internal" download="" href="../../_downloads/c06f47d7c7ea9d9f9ead93b1c0560fb5/1_create_model.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<div class="section" id="Step-1:-Create-an-amplitude-model">
<h1>Step 1: Create an amplitude model<a class="headerlink" href="#Step-1:-Create-an-amplitude-model" title="Permalink to this headline">¶</a></h1>
<p>Your analysis starts by defining an amplitude model that describes the reaction process you want to study. Such a model is generally very complex and requires a fair amount of effort by the analyst (you). This also gives a lot of room for mistakes.</p>
<p>To facilitate this process of defining an amplitude model, <code class="docutils literal notranslate"><span class="pre">pycompwa</span></code> comes with a so-called <a class="reference external" href="https://en.wikipedia.org/wiki/Expert_system">‘expert system’</a>. Its responsibility is to give you advice on the form of an amplitude model based on the problem set you define (initial state, final state, allowed interactions, intermediate states, etc.). Internally, the system propagates the quantum numbers through the reaction graph while satisfying the specified conservation rules. How to control
this procedure is explained in more detail below.</p>
<p>Afterwards, the amplitude model of the expert system can be exported. The model can for instance be used to generate a data set (toy Monte Carlo) for this reaction and to optimize its parameters to resemble an actual data set as good as possible.</p>
<div class="section" id="1.1.-Define-the-problem-set">
<h2>1.1. Define the problem set<a class="headerlink" href="#1.1.-Define-the-problem-set" title="Permalink to this headline">¶</a></h2>
<p>We first define the boundary conditions of our physics problem, such as
initial state, final state, formalism type, etc. and pass all of that
information to the <a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">StateTransitionManager</span></code></a>. This is the main user
interface class of the ComPWA expert system.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pycompwa.expertsystem.ui.system_control</span> <span class="kn">import</span> <span class="n">StateTransitionManager</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">initial_state</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;J/psi&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span>
<span class="n">final_state</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="s2">&quot;pi0&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s2">&quot;pi0&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

<span class="n">tbd_manager</span> <span class="o">=</span> <span class="n">StateTransitionManager</span><span class="p">(</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span>
                                     <span class="n">formalism_type</span><span class="o">=</span><span class="s1">&#39;helicity&#39;</span><span class="p">,</span>
                                     <span class="n">topology_building</span><span class="o">=</span><span class="s1">&#39;isobar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">StateTransitionManager</span></code></a> (STM) is the main user interface
class of the ComPWA expert system. The boundary conditions of your
physics problem, such as the initial state, final state, formalism type,
etc., are defined through this interface.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager.prepare_graphs" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager.prepare_graphs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare_graphs()</span></code></a> of the STM creates all topology graphs ―
here, using the isobar model (a tree of two-body decays). The function
also initializes the graphs with the initial and final state and a set
of conservation laws at each interaction node.</p></li>
<li><p>By default, all three interaction types (strong, EM, weak) are used in
the preparation stage. However, it is also possible to choose the
allowed interaction types globally via
<a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager.set_allowed_interaction_types" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager.set_allowed_interaction_types"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_allowed_interaction_types()</span></code></a>.</p></li>
</ul>
<p>After the preparation step, you can modify the settings returned by
<a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager.prepare_graphs" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager.prepare_graphs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare_graphs()</span></code></a> to your liking. Since the output of this function
contains quite a lot of information, the
<a class="reference internal" href="../../api/pycompwa.expertsystem.ui.html#module-pycompwa.expertsystem.ui" title="pycompwa.expertsystem.ui"><code class="xref py py-mod docutils literal notranslate"><span class="pre">expertsystem</span> <span class="pre">UI</span></code></a> aids in the
configuration (especially the STM).</p>
<ul class="simple">
<li><p>A subset of particles that are allowed as intermediate states can also
be specified: either through the
<a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager.__init__" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager.__init__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">STM's</span> <span class="pre">constructor</span></code></a> or by
setting the instance attribute <code class="docutils literal notranslate"><span class="pre">allowed_intermediate_particles</span></code>.</p></li>
</ul>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>How does the <a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">StateTransitionManager</span></code></a> know what a <code class="docutils literal notranslate"><span class="pre">&quot;J/psi&quot;</span></code> is?
It simply uses a default particle list that is shipped with ComPWA (see
<a class="reference external" href="https://github.com/ComPWA/ComPWA/blob/master/Physics/particle_list.xml">here</a>)
and is handled by the <a class="reference internal" href="../../api/pycompwa.expertsystem.state.particle.html#module-pycompwa.expertsystem.state.particle" title="pycompwa.expertsystem.state.particle"><code class="xref py py-mod docutils literal notranslate"><span class="pre">particle</span></code></a> module. For more info, see
<a class="reference internal" href="../tools/particles.html"><span class="doc">Particle database</span></a>.</p>
</div>
</div>
<div class="section" id="1.2.-Prepare-topologies">
<h2>1.2. Prepare topologies<a class="headerlink" href="#1.2.-Prepare-topologies" title="Permalink to this headline">¶</a></h2>
<p>Create all topology graphs using the <strong>isobar model</strong> (tree of two-body decays) and initialize the graphs with the initial and final state. Remember that each interaction node defines its own set of conservation laws.</p>
<p>The <a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">StateTransitionManager</span></code></a> (STM) defines three interaction types:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Interaction</p></th>
<th class="head"><p>Strength</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>strong</p></td>
<td><p><span class="math notranslate nohighlight">\(60\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>electromagnetic (EM)</p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
</tr>
<tr class="row-even"><td><p>weak</p></td>
<td><p><span class="math notranslate nohighlight">\(10^{-4}\)</span></p></td>
</tr>
</tbody>
</table>
<p>By default, all three are used in the preparation stage. The function
<a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager.prepare_graphs" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager.prepare_graphs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare_graphs()</span></code></a> of the STM generates graphs with all possible
combinations of interaction nodes. An overall interaction strength is
assigned to each graph and they are grouped according to this strength.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">graph_interaction_settings_groups</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">prepare_graphs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1.3.-Find-solutions">
<h2>1.3. Find solutions<a class="headerlink" href="#1.3.-Find-solutions" title="Permalink to this headline">¶</a></h2>
<p>If you are happy with the default settings generated by the
<a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">StateTransitionManager</span></code></a>, just start with solving directly!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step takes about 30 sec on an Intel(R) Core(TM) i7-6820HQ CPU
&#64; 2.70GHz running multi-threaded</p>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">solutions</span><span class="p">,</span> <span class="n">violated_rules</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span>
    <span class="n">graph_interaction_settings_groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pycompwa.expertsystem.topology.graph</span> <span class="kn">import</span> <span class="n">get_intermediate_state_edges</span>

<span class="k">def</span> <span class="nf">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Just a little function to print the intermediate states.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;intermediate states:&quot;</span><span class="p">)</span>
    <span class="n">intermediate_states</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">solutions</span><span class="p">:</span>
        <span class="n">edge_id</span> <span class="o">=</span> <span class="n">get_intermediate_state_edges</span><span class="p">(</span><span class="n">g</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">intermediate_states</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edge_props</span><span class="p">[</span><span class="n">edge_id</span><span class="p">][</span><span class="s1">&#39;@Name&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">intermediate_states</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">),</span> <span class="s2">&quot;solutions!&quot;</span><span class="p">)</span>
<span class="n">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
found 272 solutions!
intermediate states:
{&#39;phi(1020)&#39;, &#39;D*(2007)0&#39;, &#39;f2(1950)&#39;, &#39;a0(980)0&#39;, &#39;rho(770)0&#39;, &#39;a2(1320)0&#39;, &#39;D*(2007)0bar&#39;, &#39;omega(782)&#39;, &#39;f2(1270)&#39;, &#39;D1(2420)0&#39;, &#39;f0(1500)&#39;, &#39;f0(980)&#39;}
</pre></div></div>
</div>
<p>Now we have a lot of solutions that are actually heavily suppressed (they involve two weak decays).</p>
<p>In general, you can modify the dictionary returned by
<a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager.prepare_graphs" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager.prepare_graphs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare_graphs()</span></code></a> directly, but the STM also comes with functionality
to globally choose the allowed interaction types.</p>
<p>So, go ahead and <strong>disable</strong> the <strong>EM</strong> and <strong>weak</strong> interaction:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pycompwa.expertsystem.ui.system_control</span> <span class="kn">import</span> <span class="n">InteractionTypes</span>

<span class="n">tbd_manager</span><span class="o">.</span><span class="n">set_allowed_interaction_types</span><span class="p">([</span><span class="n">InteractionTypes</span><span class="o">.</span><span class="n">Strong</span><span class="p">])</span>
<span class="n">graph_interaction_settings_groups</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">prepare_graphs</span><span class="p">()</span>
<span class="n">solutions</span><span class="p">,</span> <span class="n">violated_rules</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span>
    <span class="n">graph_interaction_settings_groups</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">),</span> <span class="s2">&quot;solutions!&quot;</span><span class="p">)</span>
<span class="n">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:root:The specified list of interaction types [&lt;InteractionTypes.Strong: 1&gt;] does not intersect with the valid list of interaction types [&lt;InteractionTypes.Weak: 3&gt;, &lt;InteractionTypes.EM: 2&gt;].
Using valid list instead.
WARNING:root:The specified list of interaction types [&lt;InteractionTypes.Strong: 1&gt;] does not intersect with the valid list of interaction types [&lt;InteractionTypes.Weak: 3&gt;, &lt;InteractionTypes.EM: 2&gt;].
Using valid list instead.
WARNING:root:The specified list of interaction types [&lt;InteractionTypes.Strong: 1&gt;] does not intersect with the valid list of interaction types [&lt;InteractionTypes.Weak: 3&gt;, &lt;InteractionTypes.EM: 2&gt;].
Using valid list instead.
WARNING:root:The specified list of interaction types [&lt;InteractionTypes.Strong: 1&gt;] does not intersect with the valid list of interaction types [&lt;InteractionTypes.Weak: 3&gt;, &lt;InteractionTypes.EM: 2&gt;].
Using valid list instead.
WARNING:root:The specified list of interaction types [&lt;InteractionTypes.Strong: 1&gt;] does not intersect with the valid list of interaction types [&lt;InteractionTypes.Weak: 3&gt;, &lt;InteractionTypes.EM: 2&gt;].
Using valid list instead.
WARNING:root:The specified list of interaction types [&lt;InteractionTypes.Strong: 1&gt;] does not intersect with the valid list of interaction types [&lt;InteractionTypes.Weak: 3&gt;, &lt;InteractionTypes.EM: 2&gt;].
Using valid list instead.
WARNING:root:The specified list of interaction types [&lt;InteractionTypes.Strong: 1&gt;] does not intersect with the valid list of interaction types [&lt;InteractionTypes.Weak: 3&gt;, &lt;InteractionTypes.EM: 2&gt;].
Using valid list instead.
WARNING:root:The specified list of interaction types [&lt;InteractionTypes.Strong: 1&gt;] does not intersect with the valid list of interaction types [&lt;InteractionTypes.Weak: 3&gt;, &lt;InteractionTypes.EM: 2&gt;].
Using valid list instead.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
found 48 solutions!
intermediate states:
{&#39;f2(1950)&#39;, &#39;rho(770)0&#39;, &#39;f2(1270)&#39;, &#39;f0(1500)&#39;, &#39;f0(980)&#39;}
</pre></div></div>
</div>
<p>Huh, what happened here? Actually, since a <span class="math notranslate nohighlight">\(\gamma\)</span> particle appears in one of the interaction nodes, the expert system knows that this node <strong>must involve EM interactions</strong>! Because the node can be an effective interaction, the weak interaction cannot be excluded, as it contains only a subset of conservation laws.</p>
<p>Since only the strong interaction was supposed to be used, this results in a warning and the STM automatically corrects the mistake.</p>
<p>Once the EM interaction is included, this warning disappears. Be aware, however, that the EM interaction is now available globally. Hence, there now might be solutions in which both nodes are electromagnetic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tbd_manager</span><span class="o">.</span><span class="n">set_allowed_interaction_types</span><span class="p">(</span>
    <span class="p">[</span><span class="n">InteractionTypes</span><span class="o">.</span><span class="n">Strong</span><span class="p">,</span> <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">EM</span><span class="p">])</span>
<span class="n">graph_interaction_settings_groups</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">prepare_graphs</span><span class="p">()</span>
<span class="n">solutions</span><span class="p">,</span> <span class="n">violated_rules</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span>
    <span class="n">graph_interaction_settings_groups</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">),</span> <span class="s2">&quot;solutions!&quot;</span><span class="p">)</span>
<span class="n">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
found 96 solutions!
intermediate states:
{&#39;phi(1020)&#39;, &#39;f2(1950)&#39;, &#39;a0(980)0&#39;, &#39;rho(770)0&#39;, &#39;a2(1320)0&#39;, &#39;omega(782)&#39;, &#39;f2(1270)&#39;, &#39;f0(1500)&#39;, &#39;f0(980)&#39;}
</pre></div></div>
</div>
<p>Great! Now we selected only the strongest contributions. Be aware, though, that there are more effects that can suppress certain decays, like small branching ratios. In this example, the initial state <span class="math notranslate nohighlight">\(J/\Psi\)</span> can decay into <span class="math notranslate nohighlight">\(\pi^0 + \rho^0\)</span> or <span class="math notranslate nohighlight">\(\pi^0 + \omega\)</span>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>decay</p></th>
<th class="head"><p>branching ratio</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="math notranslate nohighlight">
\[\omega \rightarrow \gamma+\pi^0\]</div>
</td>
<td><p>0.0828</p></td>
</tr>
<tr class="row-odd"><td><div class="math notranslate nohighlight">
\[\rho^0 \rightarrow \gamma+\pi^0\]</div>
</td>
<td><p>0.0006</p></td>
</tr>
</tbody>
</table>
<p>Unfortunately, the <span class="math notranslate nohighlight">\(\rho^0\)</span> mainly decays into <span class="math notranslate nohighlight">\(\pi+\pi\)</span>, not <span class="math notranslate nohighlight">\(\gamma+\pi^0\)</span> and is therefore suppressed. This information is currently not known to the expert system, but it is possible to hand the expert system a list of allowed intermediate states.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># particles are found by name comparison,</span>
<span class="c1"># i.e. f2 will find all f2&#39;s and f all f&#39;s independent of their spin</span>
<span class="n">tbd_manager</span><span class="o">.</span><span class="n">allowed_intermediate_particles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span>

<span class="n">solutions</span><span class="p">,</span> <span class="n">violated_rules</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span>
    <span class="n">graph_interaction_settings_groups</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; solutions!&quot;</span><span class="p">)</span>
<span class="n">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:root:No intermediate state particles match the found 171 solutions!
WARNING:root:solution inter. state J^P: {&#39;2.0-&#39;, &#39;1.0-&#39;, &#39;2.0+&#39;, &#39;1.0+&#39;}
WARNING:root:No intermediate state particles match the found 171 solutions!
WARNING:root:solution inter. state J^P: {&#39;2.0-&#39;, &#39;1.0-&#39;, &#39;2.0+&#39;, &#39;1.0+&#39;}
WARNING:root:No intermediate state particles match the found 171 solutions!
WARNING:root:solution inter. state J^P: {&#39;2.0-&#39;, &#39;1.0-&#39;, &#39;2.0+&#39;, &#39;1.0+&#39;}
WARNING:root:No intermediate state particles match the found 171 solutions!
WARNING:root:solution inter. state J^P: {&#39;2.0-&#39;, &#39;1.0-&#39;, &#39;2.0+&#39;, &#39;1.0+&#39;}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
found 32 solutions!
intermediate states:
{&#39;f2(1950)&#39;, &#39;f0(980)&#39;, &#39;f2(1270)&#39;, &#39;f0(1500)&#39;}
</pre></div></div>
</div>
<p>Now we have selected all amplitudes that involve <strong>f</strong> states. The warnings appear only to notify the user that the list of solutions is not exhaustive: for certain edges in the graph, no suitable particle was found (since only f states were allowed).</p>
<p>Now that we are satisfied with the intermediate resonances, we are all set to generate an amplitude model!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pycompwa.expertsystem.amplitude.helicitydecay</span> <span class="kn">import</span> \
    <span class="n">HelicityAmplitudeGeneratorXML</span>

<span class="n">xml_generator</span> <span class="o">=</span> <span class="n">HelicityAmplitudeGeneratorXML</span><span class="p">()</span>
<span class="n">xml_generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
<span class="n">xml_generator</span><span class="o">.</span><span class="n">write_to_file</span><span class="p">(</span><span class="s1">&#39;model.xml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this example, we used the helicity formalism. If you want to work with
the canonical formalism, you have to:</p>
<ol class="arabic simple">
<li><p>Construct a <a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html#pycompwa.expertsystem.ui.system_control.StateTransitionManager" title="pycompwa.expertsystem.ui.system_control.StateTransitionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">StateTransitionManager</span></code></a> with argument
<code class="docutils literal notranslate"><span class="pre">formalism_type='canonical-helicity'</span></code>
instead of
<code class="docutils literal notranslate"><span class="pre">formalism_type='helicity'</span></code>.</p></li>
<li><p>Use the <a class="reference internal" href="../../api/pycompwa.expertsystem.amplitude.canonicaldecay.html#pycompwa.expertsystem.amplitude.canonicaldecay.CanonicalAmplitudeGeneratorXML" title="pycompwa.expertsystem.amplitude.canonicaldecay.CanonicalAmplitudeGeneratorXML"><code class="xref py py-class docutils literal notranslate"><span class="pre">CanonicalAmplitudeGeneratorXML</span></code></a> instead of the
<a class="reference internal" href="../../api/pycompwa.expertsystem.amplitude.helicitydecay.html#pycompwa.expertsystem.amplitude.helicitydecay.HelicityAmplitudeGeneratorXML" title="pycompwa.expertsystem.amplitude.helicitydecay.HelicityAmplitudeGeneratorXML"><code class="xref py py-class docutils literal notranslate"><span class="pre">HelicityAmplitudeGeneratorXML</span></code></a>.</p></li>
</ol>
<p>Note that you <strong>have to do both</strong>, because otherwise the resulting
amplitude will not make sense!</p>
</div>
<p>Have a look through the sections of the resulting XML file to see what you recognize from the problem set defined above. There may also be some things you want to change in there manually, so <strong>make sure you store this XML file</strong> carefully (e.g. track it with Git) so that you don’t overwrite it your changed after rerunning the expert system.</p>
<p>In the next step, we’ll use this amplitude model to generate a data sample.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="2_generate_data.html" class="btn btn-neutral float-right" title="Step 2: Generate data samples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../workflow.html" class="btn btn-neutral float-left" title="ComPWA Workflow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>