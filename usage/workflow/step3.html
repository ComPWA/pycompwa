
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Step 3: Perform fit &#8212; pycompwa</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Step 4: Analyze results" href="step4.html" />
    <link rel="prev" title="Step 2: Generate data samples" href="step2.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-small.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">pycompwa</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../install.html">
   Installation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../install/source.html">
     Get the source code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../install/virtual-environment.html">
     Create a virtual environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../install/build.html">
     Build and install
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../usage.html">
   Usage
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../workflow.html">
     ComPWA Workflow
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="step1.html">
       Step 1: Create an amplitude model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="step2.html">
       Step 2: Generate data samples
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Step 3: Perform fit
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="step4.html">
       Step 4: Analyze results
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../tools.html">
     Additional Tools
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../tools/data_module.html">
       Data module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../tools/generate.html">
       Generate data samples
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../tools/particles.html">
       Particle database
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../develop.html">
   Help developing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../documents.html">
   Talks and Documents
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../api/pycompwa.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/pycompwa.data.html">
     data
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../api/pycompwa.data.io.html">
       io
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.data.io.pawian.html">
         pawian
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../api/pycompwa.data.convert.html">
       convert
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../api/pycompwa.data.create.html">
       create
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../api/pycompwa.data.exception.html">
       exception
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../api/pycompwa.data.naming.html">
       naming
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/pycompwa.expertsystem.html">
     expertsystem
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../api/pycompwa.expertsystem.amplitude.html">
       amplitude
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.amplitude.abstractgenerator.html">
         abstractgenerator
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.amplitude.canonicaldecay.html">
         canonicaldecay
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.amplitude.helicitydecay.html">
         helicitydecay
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../api/pycompwa.expertsystem.solvers.html">
       solvers
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../api/pycompwa.expertsystem.state.html">
       state
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.state.conservationrules.html">
         conservationrules
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.state.particle.html">
         particle
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.state.propagation.html">
         propagation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../api/pycompwa.expertsystem.topology.html">
       topology
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
      <label for="toctree-checkbox-11">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.topology.graph.html">
         graph
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.topology.topologybuilder.html">
         topologybuilder
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../api/pycompwa.expertsystem.ui.html">
       ui
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
      <label for="toctree-checkbox-12">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.ui.default_settings.html">
         default_settings
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../api/pycompwa.expertsystem.ui.system_control.html">
         system_control
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/pycompwa.plotting.html">
     plotting
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../api/pycompwa.plotting.rootplotdatareader.html">
       rootplotdatareader
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../api/pycompwa.ui.html">
     ui
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Related projects
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://qrules.readthedocs.io">
   QRules
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://ampform.readthedocs.io">
   AmpForm
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://tensorwaves.readthedocs.io">
   TensorWaves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://pwa.readthedocs.io">
   PWA Pages
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  ComPWA Organization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://compwa-org.readthedocs.io">
   Website
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ComPWA">
   GitHub Repositories
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://compwa-org.readthedocs.io/en/stable/about.html">
   About
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/usage/workflow/step3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ComPWA/pycompwa"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ComPWA/pycompwa/issues/new?title=Issue%20on%20page%20%2Fusage/workflow/step3.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/ComPWA/pycompwa/edit/stable/docs/usage/workflow/step3.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ComPWA/pycompwa/stable?urlpath=lab/tree/docs/usage/workflow/step3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/ComPWA/pycompwa/blob/stable/docs/usage/workflow/step3.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-estimator">
   3.1 Define estimator
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modify-parameters">
   3.2 Modify parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimize-the-intensity-model">
   3.3 Optimize the intensity model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exporting-and-importing">
   3.4 Exporting and importing
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="step-3-perform-fit">
<h1>Step 3: Perform fit<a class="headerlink" href="#step-3-perform-fit" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <a class="reference internal" href="../../index.html"><span class="doc">pycompwa</span></a> is no longer maintained. Use the <a class="reference external" href="https://compwa-org.rtfd.io">ComPWA</a> packages <a class="reference external" href="https://qrules.rtfd.io">QRules</a>, <a class="reference external" href="https://ampform.rtfd.io">AmpForm</a>, and <a class="reference external" href="https://tensorwaves.rtfd.io">TensorWaves</a> instead!</p>
</div>
<p>As explained in the <a class="reference internal" href="step2.html"><span class="doc">previous step</span></a>, an <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.Intensity" title="pycompwa.ui.Intensity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Intensity</span></code></a> object behaves just like a mathematical function that takes a <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.DataSet" title="pycompwa.ui.DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataSet</span></code></a> as an argument and returns a list of intensities (real numbers). We now want to optimize the parameters of the intensity model so that it matches  the distribution of our data sample. This is what we call ‘performing a fit’.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We first load the relevant data from the previous steps.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pycompwa.ui</span> <span class="k">as</span> <span class="nn">pwa</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:31,463 INFO [default] Logging to file disabled!
2021-10-27 10:01:31,463 [INFO] Log level: INFO
2021-10-27 10:01:31,463 [INFO] Current date and time: Wed Oct 27 10:01:31 2021
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">particle_list</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">read_particles</span><span class="p">(</span><span class="s2">&quot;model.xml&quot;</span><span class="p">)</span>
<span class="n">kinematics</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">create_helicity_kinematics</span><span class="p">(</span><span class="s2">&quot;model.xml&quot;</span><span class="p">,</span> <span class="n">particle_list</span><span class="p">)</span>
<span class="n">kinematics</span><span class="o">.</span><span class="n">create_all_subsystems</span><span class="p">()</span>
<span class="n">data_sample</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">read_root_data</span><span class="p">(</span><span class="n">input_file</span><span class="o">=</span><span class="s2">&quot;generated_data.root&quot;</span><span class="p">)</span>
<span class="n">phsp_sample</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">read_root_data</span><span class="p">(</span><span class="n">input_file</span><span class="o">=</span><span class="s2">&quot;generated_phsp.root&quot;</span><span class="p">)</span>
<span class="n">intensity_builder</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">IntensityBuilderXML</span><span class="p">(</span>
    <span class="s2">&quot;model.xml&quot;</span><span class="p">,</span> <span class="n">particle_list</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">,</span> <span class="n">phsp_sample</span>
<span class="p">)</span>
<span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity_builder</span><span class="o">.</span><span class="n">create_intensity</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:31,890 [INFO] HelicityKinematics::HelicityKinematics() | Initialized kinematics for reaction ( J/psi )-&gt;( gamma[ID=2] pi0[ID=3] pi0[ID=4] )
Event position to final state ID mapping:
0: 2
1: 3
2: 4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:31,892 [INFO] creating all Subsystems!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:32,307 [INFO] Setting phase space sample weights...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:32,325 [INFO] Updating data container content...
</pre></div>
</div>
</div>
</div>
<div class="section" id="define-estimator">
<h2>3.1 Define estimator<a class="headerlink" href="#define-estimator" title="Permalink to this headline">¶</a></h2>
<p>To perform a fit, you need to define an <strong>estimator</strong>. An estimator is a measure for the discrepancy between the intensity model and the data distribution to which you fit. To create an estimator we therefore generally need:</p>
<ul class="simple">
<li><p>an <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.Intensity" title="pycompwa.ui.Intensity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Intensity</span></code></a> instance</p></li>
<li><p>a <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.DataSet" title="pycompwa.ui.DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataSet</span></code></a> to which we fit that intensity</p></li>
</ul>
<p>The data sample of momentum tuples can be converted to a <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.DataSet" title="pycompwa.ui.DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataSet</span></code></a> as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_set</span> <span class="o">=</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">data_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can create an estimator. In this example, we use an <strong>unbinned log likelihood</strong> estimator. This estimator is used most commonly in high-energy physics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">estimator</span><span class="p">,</span>
    <span class="n">initial_parameters</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">create_unbinned_log_likelihood_function_tree_estimator</span><span class="p">(</span>
    <span class="n">intensity</span><span class="p">,</span> <span class="n">data_set</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that you not only receive a estimator object, but also a list of fit parameters. You use this list of fit parameters to initialize the optimizer later on.</p>
<p>The parameters contains the following info:</p>
<ul class="simple">
<li><p>initial value</p></li>
<li><p>whether they are free or fixed</p></li>
<li><p>optional upper and lower limits</p></li>
<li><p>errors that give certain optimizers hints on the step size</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_parameters</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[strength_incoherent: 1 (fixed),
 mass_f21270: 1.2751 +- 0.0012 (fixed),
 Mass_gamma: 0 (fixed),
 Mass_jpsi: 3.0969 (fixed),
 Mass_neutralPion: 0.134977 +- 6e-06 (fixed),
 width_f21270: 0.185 (fixed),
 Radius_f21270: 1 (fixed),
 Magnitude_J/psi_to_f2(1270)_0+gamma_-1;f2(1270)_to_pi0_0+pi0_0;: 1,
 Phase_J/psi_to_f2(1270)_0+gamma_-1;f2(1270)_to_pi0_0+pi0_0;: 0,
 mass_f21950: 1.944 +- 0.012 (fixed),
 width_f21950: 0.472 (fixed),
 Radius_f21950: 1 (fixed),
 Magnitude_J/psi_to_f2(1950)_0+gamma_-1;f2(1950)_to_pi0_0+pi0_0;: 1,
 Phase_J/psi_to_f2(1950)_0+gamma_-1;f2(1950)_to_pi0_0+pi0_0;: 0,
 Magnitude_J/psi_to_f2(1270)_-1+gamma_-1;f2(1270)_to_pi0_0+pi0_0;: 1,
 Phase_J/psi_to_f2(1270)_-1+gamma_-1;f2(1270)_to_pi0_0+pi0_0;: 0,
 Magnitude_J/psi_to_f2(1950)_-1+gamma_-1;f2(1950)_to_pi0_0+pi0_0;: 1,
 Phase_J/psi_to_f2(1950)_-1+gamma_-1;f2(1950)_to_pi0_0+pi0_0;: 0,
 Magnitude_J/psi_to_f2(1270)_-2+gamma_-1;f2(1270)_to_pi0_0+pi0_0;: 1,
 Phase_J/psi_to_f2(1270)_-2+gamma_-1;f2(1270)_to_pi0_0+pi0_0;: 0,
 Magnitude_J/psi_to_f2(1950)_-2+gamma_-1;f2(1950)_to_pi0_0+pi0_0;: 1,
 Phase_J/psi_to_f2(1950)_-2+gamma_-1;f2(1950)_to_pi0_0+pi0_0;: 0,
 mass_f0980: 0.994 +- 0.001 (fixed),
 width_f0980: 0.07 (fixed),
 Radius_f0980: 1 (fixed),
 Magnitude_J/psi_to_f0(980)_0+gamma_-1;f0(980)_to_pi0_0+pi0_0;: 1,
 Phase_J/psi_to_f0(980)_0+gamma_-1;f0(980)_to_pi0_0+pi0_0;: 0,
 mass_f01500: 1.505 +- 0.006 (fixed),
 width_f01500: 0.109 (fixed),
 Radius_f01500: 1 (fixed),
 Magnitude_J/psi_to_f0(1500)_0+gamma_-1;f0(1500)_to_pi0_0+pi0_0;: 1,
 Phase_J/psi_to_f0(1500)_0+gamma_-1;f0(1500)_to_pi0_0+pi0_0;: 0]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="modify-parameters">
<h2>3.2 Modify parameters<a class="headerlink" href="#modify-parameters" title="Permalink to this headline">¶</a></h2>
<p>The fit parameters in this list have been initialized with the values stated in the XML file or with default values if unspecified, but they can easily be modified in Python as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">this parameter is initially not fixed:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>

<span class="n">initial_parameters</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">is_fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">initial_parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">is_fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">and now it is fixed:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>this parameter is initially not fixed:
Phase_J/psi_to_f2(1270)_0+gamma_-1;f2(1270)_to_pi0_0+pi0_0;: 0

and now it is fixed:
Phase_J/psi_to_f2(1270)_0+gamma_-1;f2(1270)_to_pi0_0+pi0_0;: 0 (fixed)
</pre></div>
</div>
</div>
</div>
<p>To make the fit process a bit more interesting, we modify one of the parameters to a different initial value than the true value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">original_value</span> <span class="o">=</span> <span class="n">initial_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">initial_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Magnitude_J/psi_to_f2(1950)_0+gamma_-1;f2(1950)_to_pi0_0+pi0_0;: 1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">initial_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Magnitude_J/psi_to_f2(1950)_0+gamma_-1;f2(1950)_to_pi0_0+pi0_0;: 2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="optimize-the-intensity-model">
<h2>3.3 Optimize the intensity model<a class="headerlink" href="#optimize-the-intensity-model" title="Permalink to this headline">¶</a></h2>
<p>Now it’s time to perform the fit! This is quite simple: just create an optimizer instance of your choice, here <a class="reference external" href="https://root.cern.ch/doc/master/Minuit2Page.html">Minuit2</a>, and call its <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.MinuitIF.optimize" title="pycompwa.ui.MinuitIF.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optimize()</span></code></a> method to start the fitting process.</p>
<p>The computation time depends on the complexity of the model, number of data events, the size of the phase space sample, and the number of free parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data size&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_sample</span><span class="o">.</span><span class="n">events</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phsp size&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">phsp_sample</span><span class="o">.</span><span class="n">events</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;free parameters:&quot;</span><span class="p">,</span>
    <span class="nb">len</span><span class="p">([</span><span class="n">par</span> <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">initial_parameters</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">par</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">]),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>data size 10000
phsp size 100000
free parameters: 14
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With 14 free parameters, this fit takes about 15 seconds on an Intel(R) Core(TM) i7-6820HQ 2.70GHz CPU.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">MinuitIF</span><span class="p">()</span>
<span class="n">fit_result</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">initial_parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:35,102 [INFO] MinuitIF::optimize() | Number of parameters (free): 32 (14)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:35,103 [INFO] Minuit2 strategy: medium
       GradientNCycles: 3
       GradientStepTolerance: 0.3
       GradientTolerance: 0.05
       HessianNCycles: 5
       HessianGradientNCycles: 2
       HessianStepTolerance: 0.3
       HessianG2Tolerance: 0.05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:35,107 [INFO] MinuitIF::optimize() | Starting migrad: maxCalls=0 tolerance=0.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:50,402 [INFO] MinuitIF::optimize() | Migrad finished! Minimum is valid = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:50,402 [INFO] MinuitIF::optimize() | Starting hesse
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:53,455 [INFO] MinuitIF::optimize() | Hesse finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-10-27 10:01:53,456 [INFO] MinuitIF::optimize() | Minimization finished! LH = -5496.086088
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_result</span><span class="o">.</span><span class="n">fit_duration_in_seconds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>18
</pre></div>
</div>
</div>
</div>
<p>Let’s check whether the fit parameters are close to the true values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">error</span>
<span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">original_value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">error</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This value is close to&quot;</span><span class="p">,</span> <span class="n">original_value</span><span class="p">,</span> <span class="s2">&quot;again:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;+-&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># upper and lower error are equal in hesse</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Value does not lie within 3 sigma!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This value is close to 1.0 again:
0.9747981229151087 +- 0.10720977443361407
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The intensity instance still needs to be notified about this optimal set of parameters. They can be applied with <a class="reference internal" href="../../api/pycompwa.ui.html#pycompwa.ui.FunctionTreeIntensity.updateParametersFrom" title="pycompwa.ui.FunctionTreeIntensity.updateParametersFrom"><code class="xref py py-meth docutils literal notranslate"><span class="pre">updateParametersFrom()</span></code></a>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intensity</span><span class="o">.</span><span class="n">updateParametersFrom</span><span class="p">(</span><span class="n">fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exporting-and-importing">
<h2>3.4 Exporting and importing<a class="headerlink" href="#exporting-and-importing" title="Permalink to this headline">¶</a></h2>
<p>Optimizing an intensity model can take a long time, so it is important that you store the fit result in the end. We again write to an XML file (but note that this has a different format than that of the amplitude model).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_result</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;fit_result.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imported_fit_result</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;fit_result.xml&quot;</span><span class="p">)</span>

<span class="n">exported_value</span> <span class="o">=</span> <span class="n">fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">imported_value</span> <span class="o">=</span> <span class="n">imported_fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

<span class="k">if</span> <span class="n">exported_value</span> <span class="o">!=</span> <span class="n">imported_value</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">imported_fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Magnitude_J/psi_to_f2(1950)_0+gamma_-1;f2(1950)_to_pi0_0+pi0_0;: 0.974798 +- 0.10721
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "ComPWA/pycompwa",
            ref: "stable",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./usage/workflow"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="step2.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Step 2: Generate data samples</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="step4.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Step 4: Analyze results</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Common Partial Wave Analysis<br/>
        
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>